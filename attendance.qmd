# Attendance {#sec-attendance}

```{r setup, include=FALSE}
# FUNCTIONS AND LIBRARIES
# have to load all data over again each document https://forum.posit.co/t/quarto-cant-find-r-objects/156848
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)    #for plots
library(partykit)   # for decision tree statistical analysis
library(tidyverse)  #for data munging including dates
library(viridis)    #color scheme

attendance <- read.csv("raw_data/processed_attendance_named.csv")
# read.csv("raw_data/processed_last_two_years_attendance.csv")
# read.csv("raw_data/processed_joined_post.csv")
# read.csv("raw_data/processed_postworkshopsurveys_named.csv")
```

## Executive summary

For workshops that we as librarians independently schedule,

  - for most topics, virtual and hybrid workshops have higher attendance (6.4) than in-person (4.3) in the last two calendar years (2023-2025)

  - a few topics have higher attendance (15) than others regardless of format

  - more detailed event descriptions seem to get higher attendance than title only descriptions


Otherwise, workshops requested by someone either standalone (such as by a department or research group) or within a course have the highest attendances.

\newpage

## Per-workshop attendance



```{r}
# Code to determine which workshops offered regularly, here equal to or more than 3 times since two years past (2023-present)

topics_common_ctree <- attendance %>%
  dplyr::filter(year > 2022) %>%
  group_by(WorkshopCode) %>%
  summarize(times_offered = n()) %>%
  dplyr::filter(times_offered >= 3,
                !is.na(WorkshopCode))
  

```

### Most recent two years (2023-2025)

#### Scheduled (not requested, not in a class) workshops

This statistical analysis addresses what factors influence attendance in librarian-scheduled (non-course, not-patron requested) frequently offered (more than two times ever) workshops in 2023-2025.

The variables significantly influencing attendance are

- topic

  - A few workshops (TIDY101, VIZ101, ZOTERO) have an average of 15.0 attendees regardless of format

- format

  - Remaining workshops have slightly higher (virtual and hybrid with an average of 6.4) or lower (4.3) attendance based on format 


All variables studied were:

-   workshop topic

-   format (in person vs virtual vs hybrid)

-   calendar year (starts in January): no significant splits

-   semester (spring, summer, or fall): no significant splits

-   multi-day vs single day scheduling: no significant splits

```{r att_tree, echo=FALSE, message = FALSE, warning = FALSE}
library(ggplot2)    #for plots
library(partykit)    #for ctree

# variables to make this only do last two years

this_year <- format(as.Date(Sys.Date(), format="%Y/%m/%d/"),"%Y")
last_two_years <- as.numeric(this_year)-2

# statistical analysis with conditional inference tree
att_tree <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    as.factor(WorkshopCode) + 
                    as.factor(Is.this.visit.part.of.a.series.) +
                    as.factor(Semester),
                  data = attendance [
                    attendance$Is.Course == "Not a course" &
                      attendance$Requested. == "No"&
                      attendance$year <= this_year &
                      attendance$year >= last_two_years &
                      attendance$WorkshopCode %in% topics_common_ctree$WorkshopCode,],
                  na.action = na.omit
                  )

att_tree

plot(att_tree)

print(paste("Scheduled workshops from", last_two_years, "to", this_year, "(last two calendar years)"))

```

#### All workshops (including visits to classes and requested workshops)

When we examine all workshops over all dates with data (included on-request visits to classes and on-request workshops, and uncommonly offered topics), we add the following variables:

-   workshop was in a course

-   requested or not

We removed workshop topic as a variable to split on, because some topics were only offered once and so that variable is a less informative split.
  
Overall, requested and within-course workshops and hybrid/virtual workshops are more highly attended

Early years (2018-2019, 2021) are highest attended for non-course events regardless of request or format. Spring and Fall semesters had differing attendance in those early years, but not in more recent years.  

In the remaining years, mainly more recent ones (2020, 2022-2025), requested events are highest (11), followed by non-requested hybrid or virtual events (7.4), with non-requested in person events lowest (4.9).

```{r att_tree4, echo=FALSE, message = FALSE, warning = FALSE}
att_tree4 <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    #as.factor(WorkshopCode) + 
                    #as.factor(Is.this.visit.part.of.a.series.)+
                    as.factor(Semester) +
                    as.factor(Is.Course) +
                    as.factor(Requested.)
                  ,
                  data = attendance,
                  na.action = na.omit
                  )

att_tree4

plot(att_tree4)
```




### Workshop attendance over time

The median number of people at each scheduled workshop has declined slightly per calendar year after 2022 and appears to be stable now as of late 2025. Workshop attendance at courses is higher, presumably because most classes have to reach a certain enrollment to "make".

```{r avg_attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
plot_time <- attendance %>% 
  ggplot(mapping = aes(x = as.factor(year),
                       y = Total.Attendees,
                       fill = Is.Course)) +
  geom_boxplot(notch = TRUE) +
  labs (y = "Total attendees per workshop",
        x = "Calendar year",
        fill = "Workshop offered in course")
plot_time
```


## Total people reached

The total number of people reached has no strong trends between 2021-2024 and has increased in 2025 compared to 2024.

```{r, total_reached_over_time, echo=FALSE, message = FALSE, warning = FALSE}

attendance %>%
  group_by(year, Is.Course) %>%
  summarize(total_reached = sum(Total.Attendees, na.rm = TRUE)) %>%
  bind_rows(summarise(.,
                      across(where(is.numeric), sum),
                      across(where(is.character), ~"Total")))%>% # https://stackoverflow.com/a/50322272
  pivot_wider(names_from =  year,
              values_from = total_reached)
  
```

When we examined whether proportionately we reach more people in or out of courses, we seem to have stabilized since 2022 at around one-third of our learners reached being in courses.  About a quarter of our workshops are now conducted in classes (@sec-offerings) but these reach about a third of our learners, suggesting these are a higher impact way to reach more people per staff time.

```{r, prop_attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
# https://r-graphics.org/recipe-bar-graph-proportional-stacked-bar
attendance %>%
  group_by(year,
           Is.Course) %>%
  summarize(total_reached = sum(Total.Attendees, na.rm = TRUE)) %>%
ggplot(
       aes(x = year,
           y = total_reached,
           fill = Is.Course)) +
  geom_col(position = "fill")+
    scale_fill_viridis_d (aesthetics = "fill")+
  labs(y = "Proportion of people reached",
       x = "Calendar year",
       fill = "Workshop offered in course")


```

\newpage

::: content-hidden
## Workshop length vs attendance

### length of session

-   Low priority: session length vs attendance

### Single day over multiple sessions vs two-day workshops

```{r carpentries_attendance, echo=FALSE, message = FALSE, warning = FALSE}
# #Last one! Plotting attendance for carpentries by multi-day VS single-topic
# 
# carpentries <- workshop %>% filter(grepl('Standalone Bash|Standalone Carpentries R|Standalone Git|
#                                               Standalone Openrefine|Standalone Python|Standalone SQL|Two-day Carpentries with R|Two-day Carpentries with Python', Topic))
# 
# carpentries %>%
#   ggplot (aes(x=Topic, y=Total.Attendees, fill=Topic)) +
#   geom_boxplot(outlier.shape = NA) +
#   scale_fill_viridis(discrete = TRUE) +
#   theme(panel.background = element_rect(fill = "lightgray",
#                                         color = "white",
#                                         size = 0.5, linetype = "solid"),
#         panel.grid.major = element_line(size = 0.5, linetype = "solid",
#                                         color = "darkgray"),
#         panel.grid.minor = element_line(size = 0.25, linetype = "solid",
#                                         color = "darkgray"),
#         plot.title = element_text(size = 20, hjust = 0.5),
#         axis.title = element_text(size = 14),
#         axis.text = element_text(size = 12, angle = 90, hjust = 0.95, vjust = 0.2)
#   )+
#   geom_jitter(alpha = 0.55, size = 4, position = position_jitter (width = .08, height = .04), show.legend = FALSE) +
#   ggtitle('Multi-Day VS Single Day Workshops')


```

## Workshop helper load for on-request workshops over time

DSI request 2023/07: - TODO: Libraries personnel to attendance ratios for On Request workshops. which high-helper topics requested more over time and do we have enough data yet, are those increasing.

```{r attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
 # plot_helpers <- attendance[attendance$Requested.=="Y",] %>%
 #   ggplot(mapping = aes(x = as.factor(Calendar.Year),
 #                        y = helpers/Total.Attendees,
 #                        fill = Topic)) +
 #   geom_boxplot(notch = TRUE)
 # plot_helpers
```

\newpage
:::
