# Attendance {#sec-attendance}

```{r setup, include=FALSE}
# FUNCTIONS AND LIBRARIES
# have to load all data over again each document https://forum.posit.co/t/quarto-cant-find-r-objects/156848
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)    #for plots
library(partykit)   # for decision tree statistical analysis
library(tidyverse)  #for data munging including dates
library(viridis)    #color scheme

attendance <- read.csv("raw_data/processed_attendance_named.csv")
# read.csv("raw_data/processed_last_two_years_attendance.csv")
# read.csv("raw_data/processed_joined_post.csv")
# read.csv("raw_data/processed_postworkshopsurveys_named.csv")
```

## Executive summary

**Counts of workshop attendance are only influenced by whether a workshop was presented as part of course instruction.** Format (virtual, in-person, hybrid) and marketing did not change attendance counts. Even topics (@sec-topics) didn't impact attendance counts.

\newpage

## Per-workshop attendance by format and request

### Statistical analysis


#### For last two years (2023-2025): Scheduled (not requested, not in a class) workshops

For scheduled (non-course) workshops in 2023-2025, topic and format are impacting numbers a conditional inference tree analysis.  Virtual and hybrid workshops are grouped within most workshops.  A few workshops (INTROPY = Introduction to Python), NEWSAA=African American Newspapers, TIDY101=Introduction to Spreadsheets/Formatting Data for Analysis, and ZOTERO=Citation Management with Zotero) are format-agnostic for attendance.

The variables included were:

-   format (in person vs virtual vs hybrid)

-   calendar year (starts in January)

-   semester (spring, summer, or fall)

-   workshop topic

-   multi-day vs single day scheduling

```{r att_tree, echo=FALSE, message = FALSE, warning = FALSE, output = FALSE}
library(ggplot2)    #for plots
library(partykit)    #for ctree
this_year <- format(as.Date(Sys.Date(), format="%Y/%m/%d/"),"%Y")
last_two_years <- as.numeric(this_year)-2
att_tree <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    as.factor(WorkshopCode) + 
                    as.factor(Is.this.visit.part.of.a.series.) +
                    as.factor(Semester),
                   # hour,
                  data = attendance [
                    attendance$Is.Course == "Not a course" &
                      attendance$Requested. == "No"&
                      attendance$year <= this_year &
                      attendance$year >= last_two_years,],
                  na.action = na.omit
                  )

att_tree

plot(att_tree)

print(paste("Workshops from", last_two_years, "to", this_year, "(last two calendar years)"))

```
#### For last two years: All workshops (including visits to classes and requested workshops)

When we examine all workshops (included on-request visits to classes and on-request workshops), we add the following variables:

-   workshop was in a course

-   requested or not

Whether a workshop was requested (most of which are courses, where students are presumably required to attend) was the most dramatic factor in increased attendance numbers. For workshops not requested (our scheduled ones), virtual and hybrid workshops have the highest attendance.  For in person not requested, BBASH, INTROPY, INTROR, STORY, ZOTERO have the highest attendance.

```{r att_tree2, echo=FALSE, message = FALSE, warning = FALSE}
att_tree2 <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    as.factor(WorkshopCode) + 
                    as.factor(Is.this.visit.part.of.a.series.)+
                    as.factor(Semester) +
                    # hour +
                    as.factor(Is.Course) +
                    as.factor(Requested.)
                  ,
                  data = attendance[
                      attendance$year <= this_year &
                      attendance$year >= last_two_years,],
                  na.action = na.omit
                  )

att_tree2

plot(att_tree2)
```

#### For all time

Scheduled non-requested workshops in 2018, 2019, 2021 with  multi-day scheduling had the highest attendance (aka Carpentries workshops).  In more recent years, hybrid and virtual had the highest attendance.


The variables included were:

-   format (in person vs virtual vs hybrid)

-   calendar year (starts in January)

-   semester (spring, summer, or fall)

-   multi-day vs single day scheduling

Workshop topic had to be excluded for too  many splits in the model.

```{r att_tree, echo=FALSE, message = FALSE, warning = FALSE, output = FALSE}
library(ggplot2)    #for plots
library(partykit)    #for ctree
att_tree3 <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    # as.factor(WorkshopCode) + 
                    as.factor(Is.this.visit.part.of.a.series.) +
                    as.factor(Semester),
                   # hour,
                  data = attendance [
                    attendance$Is.Course == "Not a course" &
                      attendance$Requested. == "No",],
                  na.action = na.omit
                  )

att_tree3

plot(att_tree3)

print(paste("Workshops from all data all time"))
```
When we examine all workshops (included on-request visits to classes and on-request workshops), we add the following variables:

-   workshop was in a course

-   requested or not

The plot is more complex now, but reflects trends in all the previous subset analyses.  Early years are highest attended for non-requested events.  Requested and within-course workshops and hybrid/virtual workshops are more highly attended.

```{r att_tree2, echo=FALSE, message = FALSE, warning = FALSE}
att_tree4 <- ctree(Total.Attendees ~ 
                    as.factor(Format) +
                    as.factor(year)+
                    # as.factor(WorkshopCode) + 
                    as.factor(Is.this.visit.part.of.a.series.)+
                    as.factor(Semester) +
                    # hour +
                    as.factor(Is.Course) +
                    as.factor(Requested.)
                  ,
                  data = attendance,
                  na.action = na.omit
                  )

att_tree4

plot(att_tree4)
```


### Format (for all workshops ever)

Ignoring all other factors, the workshop format was not significantly different using a different statistical test, a visual analysis called notched box plots. The overlapping "notches" here show that there is no difference between median attendance for scheduled (not on request, not in a class) workshops by format.  This differs slightly from the analyses above, where we also account for topics and are clustering based on a different algorithm.

```{r attendance_by_format_request, echo=FALSE, message = FALSE, warning = FALSE}
attendance[attendance$Is.Course == "Not a course" &
                             attendance$Requested. == "No",]%>%
  ggplot(mapping = aes(x = Format,
                       y = Total.Attendees))+
  geom_boxplot(notch = TRUE) + 
  labs(x = "Workshop format",
         y = "Total attendees per workshop"
         )


```

### Workshop attendance over time

The median number of people at each scheduled workshop has declined slightly per calendar year after 2022 and appears to be stable now as of late 2025. Workshop attendance at courses is higher, presumably because most classes have to reach a certain enrollment to "make".

```{r avg_attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
plot_time <- attendance %>% 
  ggplot(mapping = aes(x = as.factor(year),
                       y = Total.Attendees,
                       fill = Is.Course)) +
  geom_boxplot(notch = TRUE) +
  labs (y = "Total attendees per workshop",
        x = "Calendar year",
        fill = "Workshop offered in course")
plot_time
```


## Total people reached

The total number of people reached has no strong trends between 2021-2024 and has increased in 2025 compared to 2024.

```{r, total_reached_over_time, echo=FALSE, message = FALSE, warning = FALSE}

attendance %>%
  group_by(year, Is.Course) %>%
  summarize(total_reached = sum(Total.Attendees, na.rm = TRUE)) %>%
  bind_rows(summarise(.,
                      across(where(is.numeric), sum),
                      across(where(is.character), ~"Total")))%>% # https://stackoverflow.com/a/50322272
  pivot_wider(names_from =  year,
              values_from = total_reached)
  
```

The proportion of total people reached each calendar year in courses peaked in 2020, declined, and then has increased each calendar year since 2021, appearing to stabilize in 2024-2025.  It seems plausible that most people were only attending classes during 2020, peak Covid.

```{r, prop_attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
# https://r-graphics.org/recipe-bar-graph-proportional-stacked-bar
attendance %>%
  group_by(year,
           Is.Course) %>%
  summarize(count_per_each = n()) %>%
ggplot(
       aes(x = year,
           y = count_per_each,
           fill = Is.Course)) +
  geom_col(position = "fill")+
    scale_fill_viridis_d (aesthetics = "fill")+
  labs(y = "Proportion of people reached",
       x = "Calendar year",
       fill = "Workshop offered in course")


```

\newpage

::: content-hidden
## Workshop length vs attendance

### length of session

-   Low priority: session length vs attendance

### Single day over multiple sessions vs two-day workshops

```{r carpentries_attendance, echo=FALSE, message = FALSE, warning = FALSE}
# #Last one! Plotting attendance for carpentries by multi-day VS single-topic
# 
# carpentries <- workshop %>% filter(grepl('Standalone Bash|Standalone Carpentries R|Standalone Git|
#                                               Standalone Openrefine|Standalone Python|Standalone SQL|Two-day Carpentries with R|Two-day Carpentries with Python', Topic))
# 
# carpentries %>%
#   ggplot (aes(x=Topic, y=Total.Attendees, fill=Topic)) +
#   geom_boxplot(outlier.shape = NA) +
#   scale_fill_viridis(discrete = TRUE) +
#   theme(panel.background = element_rect(fill = "lightgray",
#                                         color = "white",
#                                         size = 0.5, linetype = "solid"),
#         panel.grid.major = element_line(size = 0.5, linetype = "solid",
#                                         color = "darkgray"),
#         panel.grid.minor = element_line(size = 0.25, linetype = "solid",
#                                         color = "darkgray"),
#         plot.title = element_text(size = 20, hjust = 0.5),
#         axis.title = element_text(size = 14),
#         axis.text = element_text(size = 12, angle = 90, hjust = 0.95, vjust = 0.2)
#   )+
#   geom_jitter(alpha = 0.55, size = 4, position = position_jitter (width = .08, height = .04), show.legend = FALSE) +
#   ggtitle('Multi-Day VS Single Day Workshops')


```

## Workshop helper load for on-request workshops over time

DSI request 2023/07: - TODO: Libraries personnel to attendance ratios for On Request workshops. which high-helper topics requested more over time and do we have enough data yet, are those increasing.

```{r attendance_over_time, echo=FALSE, message = FALSE, warning = FALSE}
 # plot_helpers <- attendance[attendance$Requested.=="Y",] %>%
 #   ggplot(mapping = aes(x = as.factor(Calendar.Year),
 #                        y = helpers/Total.Attendees,
 #                        fill = Topic)) +
 #   geom_boxplot(notch = TRUE)
 # plot_helpers
```

\newpage
:::
